<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RellCloud NetOps — Network Monitor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-base: #0a0f1a;
            --bg-surface: #111827;
            --bg-elevated: #1a2236;
            --bg-hover: #1f2a3f;
            --bg-input: #0d1322;
            --border: #1e2d44;
            --border-subtle: #162032;
            --text-primary: #e8ecf4;
            --text-secondary: #8896b0;
            --text-tertiary: #5a6882;
            --accent: #22d3ee;
            --accent-dim: rgba(34,211,238,0.12);
            --green: #10b981;
            --green-dim: rgba(16,185,129,0.12);
            --amber: #f59e0b;
            --amber-dim: rgba(245,158,11,0.12);
            --red: #ef4444;
            --red-dim: rgba(239,68,68,0.12);
            --sidebar-w: 240px;
            --header-h: 56px;
            --radius: 8px;
            --radius-lg: 12px;
            --font-ui: 'Inter', -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);
            --transition: 150ms ease;
        }

        [data-theme="light"] {
            --bg-base: #f1f5f9;
            --bg-surface: #ffffff;
            --bg-elevated: #f8fafc;
            --bg-hover: #f1f5f9;
            --bg-input: #f8fafc;
            --border: #e2e8f0;
            --border-subtle: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --accent: #0891b2;
            --accent-dim: rgba(8,145,178,0.08);
            --green: #059669;
            --green-dim: rgba(5,150,105,0.08);
            --amber: #d97706;
            --amber-dim: rgba(217,119,6,0.08);
            --red: #dc2626;
            --red-dim: rgba(220,38,38,0.08);
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.1);
        }

        html { height: 100%; }
        body {
            font-family: var(--font-ui);
            background: var(--bg-base);
            color: var(--text-primary);
            height: 100%;
            overflow: hidden;
            font-size: 14px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .app {
            display: grid;
            grid-template-columns: var(--sidebar-w) 1fr;
            grid-template-rows: var(--header-h) 1fr;
            height: 100vh;
            grid-template-areas: "sidebar header" "sidebar main";
        }

        /* ── Sidebar ─────────────────────────────── */
        .sidebar {
            grid-area: sidebar;
            background: var(--bg-surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 40;
        }
        .sidebar-brand {
            height: var(--header-h);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            gap: 10px;
            flex-shrink: 0;
        }
        .sidebar-brand .brand-icon {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, var(--accent), #06b6d4);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; color: #0a0f1a; font-weight: 700;
        }
        .sidebar-brand h1 {
            font-size: 15px; font-weight: 700;
            letter-spacing: -0.02em; color: var(--text-primary);
        }
        .sidebar-brand h1 span { color: var(--accent); }

        .sidebar-nav {
            flex: 1; padding: 16px 12px;
            display: flex; flex-direction: column; gap: 2px;
        }
        .nav-label {
            font-size: 10px; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.08em;
            color: var(--text-tertiary); padding: 16px 12px 6px;
        }
        .nav-item {
            display: flex; align-items: center; gap: 10px;
            padding: 9px 12px; border-radius: 6px; cursor: pointer;
            color: var(--text-secondary); font-size: 13px; font-weight: 500;
            transition: all var(--transition);
            border: 1px solid transparent; user-select: none;
        }
        .nav-item i { width: 18px; text-align: center; font-size: 14px; }
        .nav-item:hover { background: var(--bg-hover); color: var(--text-primary); }
        .nav-item.active {
            background: var(--accent-dim); color: var(--accent);
            border-color: rgba(34,211,238,0.15);
        }
        .nav-item .badge {
            margin-left: auto; font-family: var(--font-mono);
            font-size: 11px; font-weight: 500; padding: 1px 7px;
            border-radius: 10px; background: var(--bg-hover); color: var(--text-tertiary);
        }
        .nav-item.active .badge { background: rgba(34,211,238,0.15); color: var(--accent); }

        .sidebar-footer {
            padding: 16px; border-top: 1px solid var(--border); flex-shrink: 0;
        }
        .sidebar-status {
            display: flex; align-items: center; gap: 8px;
            font-size: 12px; color: var(--text-tertiary);
        }
        .sidebar-status .pulse {
            width: 7px; height: 7px; border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 0 0 rgba(16,185,129,0.4);
            animation: pulse-ring 2s ease infinite;
        }
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(16,185,129,0.4); }
            70% { box-shadow: 0 0 0 6px rgba(16,185,129,0); }
            100% { box-shadow: 0 0 0 0 rgba(16,185,129,0); }
        }

        /* ── Header ──────────────────────────────── */
        .header {
            grid-area: header; height: var(--header-h);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 24px; background: var(--bg-surface);
        }
        .header-left { display: flex; align-items: center; gap: 16px; }
        .page-title { font-size: 15px; font-weight: 600; letter-spacing: -0.01em; }
        .header-right { display: flex; align-items: center; gap: 12px; }

        .live-indicator {
            display: flex; align-items: center; gap: 6px;
            font-family: var(--font-mono); font-size: 11px; color: var(--green);
            background: var(--green-dim); padding: 4px 10px;
            border-radius: 20px; border: 1px solid rgba(16,185,129,0.2);
        }
        .live-indicator .dot {
            width: 6px; height: 6px; border-radius: 50%;
            background: var(--green); animation: pulse-ring 2s ease infinite;
        }

        .header-btn {
            width: 34px; height: 34px;
            display: flex; align-items: center; justify-content: center;
            border-radius: var(--radius); border: 1px solid var(--border);
            background: transparent; color: var(--text-secondary);
            cursor: pointer; font-size: 14px; transition: all var(--transition);
        }
        .header-btn:hover { background: var(--bg-hover); color: var(--text-primary); border-color: var(--text-tertiary); }

        .btn-primary {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 7px 14px; border-radius: var(--radius); border: none;
            background: var(--accent); color: #0a0f1a;
            font-family: var(--font-ui); font-size: 13px; font-weight: 600;
            cursor: pointer; transition: all var(--transition);
        }
        .btn-primary:hover { opacity: 0.85; transform: translateY(-1px); }
        .btn-primary:active { transform: translateY(0); }

        .btn-ghost {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 7px 14px; border-radius: var(--radius);
            border: 1px solid var(--border); background: transparent;
            color: var(--text-secondary); font-family: var(--font-ui);
            font-size: 13px; font-weight: 500; cursor: pointer;
            transition: all var(--transition);
        }
        .btn-ghost:hover { background: var(--bg-hover); color: var(--text-primary); }

        /* ── Main ────────────────────────────────── */
        .main {
            grid-area: main; overflow-y: auto;
            padding: 24px; scroll-behavior: smooth;
        }
        .main::-webkit-scrollbar { width: 6px; }
        .main::-webkit-scrollbar-track { background: transparent; }
        .main::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        .view { display: none; animation: fadeUp 0.2s ease; }
        .view.active { display: block; }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ── KPI Cards ───────────────────────────── */
        .kpi-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 16px; margin-bottom: 24px;
        }
        .kpi-card {
            background: var(--bg-surface); border: 1px solid var(--border);
            border-radius: var(--radius-lg); padding: 20px;
            position: relative; overflow: hidden;
            transition: border-color var(--transition);
        }
        .kpi-card:hover { border-color: var(--text-tertiary); }
        .kpi-card .kpi-icon {
            width: 36px; height: 36px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 15px; margin-bottom: 14px;
        }
        .kpi-card .kpi-label {
            font-size: 12px; font-weight: 500; color: var(--text-tertiary);
            text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 4px;
        }
        .kpi-card .kpi-value {
            font-family: var(--font-mono); font-size: 28px; font-weight: 600;
            letter-spacing: -0.03em; line-height: 1.1;
        }
        .kpi-card .kpi-sub {
            font-size: 12px; color: var(--text-tertiary);
            margin-top: 6px; font-family: var(--font-mono);
        }
        .kpi-card.kpi-total .kpi-icon { background: var(--accent-dim); color: var(--accent); }
        .kpi-card.kpi-online .kpi-icon { background: var(--green-dim); color: var(--green); }
        .kpi-card.kpi-offline .kpi-icon { background: var(--red-dim); color: var(--red); }
        .kpi-card.kpi-latency .kpi-icon { background: var(--amber-dim); color: var(--amber); }
        .kpi-card.kpi-online .kpi-value { color: var(--green); }
        .kpi-card.kpi-offline .kpi-value { color: var(--red); }

        /* ── Toolbar ─────────────────────────────── */
        .toolbar {
            display: flex; align-items: center; gap: 10px;
            margin-bottom: 16px; flex-wrap: wrap;
        }
        .search-box {
            display: flex; align-items: center; gap: 8px;
            background: var(--bg-input); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 0 12px;
            flex: 1; min-width: 200px; max-width: 360px;
            transition: border-color var(--transition);
        }
        .search-box:focus-within { border-color: var(--accent); }
        .search-box i { color: var(--text-tertiary); font-size: 13px; }
        .search-box input {
            flex: 1; border: none; background: transparent;
            color: var(--text-primary); font-family: var(--font-ui);
            font-size: 13px; padding: 8px 0; outline: none;
        }
        .search-box input::placeholder { color: var(--text-tertiary); }

        .filter-select {
            padding: 8px 30px 8px 12px; border-radius: var(--radius);
            border: 1px solid var(--border); background: var(--bg-input);
            color: var(--text-secondary); font-family: var(--font-ui);
            font-size: 13px; cursor: pointer; outline: none;
            transition: border-color var(--transition);
            -webkit-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%235a6882' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: right 10px center;
        }
        .filter-select:focus { border-color: var(--accent); }

        /* ── Device Cards ────────────────────────── */
        .device-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 14px;
        }
        .device-card {
            background: var(--bg-surface); border: 1px solid var(--border);
            border-radius: var(--radius-lg); padding: 18px;
            transition: all var(--transition); position: relative; overflow: hidden;
        }
        .device-card::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0;
            width: 3px; border-radius: 3px 0 0 3px;
            transition: background var(--transition);
        }
        .device-card.online::before { background: var(--green); }
        .device-card.offline::before { background: var(--red); }
        .device-card:hover {
            border-color: var(--text-tertiary);
            transform: translateY(-1px); box-shadow: var(--shadow-md);
        }
        .device-card-header {
            display: flex; justify-content: space-between;
            align-items: flex-start; margin-bottom: 12px;
        }
        .device-info h3 { font-size: 14px; font-weight: 600; letter-spacing: -0.01em; margin-bottom: 2px; }
        .device-info .device-ip { font-family: var(--font-mono); font-size: 12px; color: var(--text-tertiary); }

        .status-dot {
            width: 9px; height: 9px; border-radius: 50%;
            flex-shrink: 0; margin-top: 4px;
        }
        .status-dot.online {
            background: var(--green);
            box-shadow: 0 0 0 0 rgba(16,185,129,0.4);
            animation: pulse-ring 2s ease infinite;
        }
        .status-dot.offline { background: var(--red); }

        .device-latency {
            font-family: var(--font-mono); font-size: 32px; font-weight: 600;
            letter-spacing: -0.04em; line-height: 1; margin-bottom: 4px;
        }
        .device-latency .unit { font-size: 14px; font-weight: 400; color: var(--text-tertiary); margin-left: 2px; }
        .device-latency.good { color: var(--green); }
        .device-latency.warn { color: var(--amber); }
        .device-latency.bad { color: var(--red); }
        .device-latency.down { color: var(--red); font-size: 18px; }

        .device-sparkline {
            margin-top: 12px; border-top: 1px solid var(--border-subtle); padding-top: 12px;
        }
        .device-sparkline svg { width: 100%; height: 40px; display: block; }

        .device-card-footer {
            display: flex; justify-content: space-between;
            align-items: center; margin-top: 10px;
        }
        .device-category {
            font-size: 11px; font-weight: 500; text-transform: uppercase;
            letter-spacing: 0.04em; padding: 2px 8px; border-radius: 4px;
            background: var(--bg-hover); color: var(--text-tertiary);
        }
        .device-delete {
            opacity: 0; border: none; background: transparent;
            color: var(--text-tertiary); cursor: pointer; padding: 4px;
            border-radius: 4px; font-size: 12px; transition: all var(--transition);
        }
        .device-card:hover .device-delete { opacity: 1; }
        .device-delete:hover { color: var(--red); background: var(--red-dim); }

        /* ── Server Cards ────────────────────────── */
        .server-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 14px;
        }
        .server-card {
            background: var(--bg-surface); border: 1px solid var(--border);
            border-radius: var(--radius-lg); padding: 20px;
            transition: all var(--transition);
        }
        .server-card:hover {
            border-color: var(--text-tertiary);
            transform: translateY(-1px); box-shadow: var(--shadow-md);
        }
        .server-card-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 16px;
        }
        .server-name { font-size: 15px; font-weight: 600; }
        .server-status {
            font-family: var(--font-mono); font-size: 11px; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.04em;
            padding: 3px 10px; border-radius: 20px;
        }
        .server-status.online { background: var(--green-dim); color: var(--green); border: 1px solid rgba(16,185,129,0.2); }
        .server-status.reachable { background: var(--amber-dim); color: var(--amber); border: 1px solid rgba(245,158,11,0.2); }
        .server-status.offline { background: var(--red-dim); color: var(--red); border: 1px solid rgba(239,68,68,0.2); }

        .server-meta { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
        .server-meta-row {
            display: flex; align-items: center; gap: 8px;
            font-size: 13px; color: var(--text-secondary);
        }
        .server-meta-row i { width: 16px; text-align: center; color: var(--text-tertiary); font-size: 12px; }
        .server-meta-row .mono { font-family: var(--font-mono); font-size: 12px; }

        .server-checks { display: flex; gap: 12px; margin-bottom: 16px; }
        .check-badge {
            display: flex; align-items: center; gap: 5px;
            font-size: 12px; font-weight: 500; padding: 4px 10px;
            border-radius: 6px; background: var(--bg-hover); color: var(--text-secondary);
        }
        .check-badge.pass { color: var(--green); }
        .check-badge.fail { color: var(--red); }

        .server-actions { display: flex; gap: 8px; }
        .ssh-copy-btn {
            flex: 1; display: flex; align-items: center; justify-content: center;
            gap: 6px; padding: 8px 12px; border: 1px solid var(--border);
            border-radius: var(--radius); background: var(--bg-input);
            color: var(--text-secondary); font-family: var(--font-mono);
            font-size: 12px; cursor: pointer; transition: all var(--transition);
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        }
        .ssh-copy-btn:hover { border-color: var(--accent); color: var(--accent); }
        .ssh-copy-btn.copied { border-color: var(--green); color: var(--green); background: var(--green-dim); }

        .server-delete-btn {
            width: 36px; height: 36px;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid var(--border); border-radius: var(--radius);
            background: transparent; color: var(--text-tertiary);
            cursor: pointer; font-size: 13px; flex-shrink: 0;
            transition: all var(--transition);
        }
        .server-delete-btn:hover { border-color: var(--red); color: var(--red); background: var(--red-dim); }

        /* ── Modal ───────────────────────────────── */
        .modal-backdrop {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            z-index: 100; display: none;
            align-items: center; justify-content: center;
            animation: fadeIn 0.15s ease;
        }
        .modal-backdrop.open { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal {
            background: var(--bg-surface); border: 1px solid var(--border);
            border-radius: var(--radius-lg); width: 440px; max-width: 95vw;
            box-shadow: var(--shadow-lg); animation: modalSlide 0.2s ease;
        }
        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(12px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 18px 22px; border-bottom: 1px solid var(--border);
        }
        .modal-header h2 { font-size: 16px; font-weight: 600; }
        .modal-close {
            width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            border: none; background: transparent; color: var(--text-tertiary);
            cursor: pointer; border-radius: 6px; font-size: 16px;
            transition: all var(--transition);
        }
        .modal-close:hover { background: var(--bg-hover); color: var(--text-primary); }
        .modal-body { padding: 22px; }
        .form-group { margin-bottom: 16px; }
        .form-group label {
            display: block; font-size: 12px; font-weight: 500;
            color: var(--text-secondary); margin-bottom: 6px;
        }
        .form-group input {
            width: 100%; padding: 9px 12px; border-radius: var(--radius);
            border: 1px solid var(--border); background: var(--bg-input);
            color: var(--text-primary); font-family: var(--font-ui);
            font-size: 13px; outline: none; transition: border-color var(--transition);
        }
        .form-group input:focus { border-color: var(--accent); }
        .form-group input::placeholder { color: var(--text-tertiary); }
        .modal-footer { display: flex; justify-content: flex-end; gap: 8px; padding: 0 22px 18px; }

        /* ── Empty State ─────────────────────────── */
        .empty-state {
            text-align: center; padding: 60px 20px; color: var(--text-tertiary);
        }
        .empty-state i { font-size: 48px; margin-bottom: 16px; opacity: 0.3; }
        .empty-state h3 { font-size: 16px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; }
        .empty-state p { font-size: 13px; max-width: 300px; margin: 0 auto; }

        /* ── Toasts ──────────────────────────────── */
        .toast-container {
            position: fixed; top: 16px; right: 16px; z-index: 200;
            display: flex; flex-direction: column; gap: 8px; pointer-events: none;
        }
        .toast {
            background: var(--bg-elevated); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 12px 16px;
            display: flex; align-items: center; gap: 10px;
            font-size: 13px; box-shadow: var(--shadow-lg);
            animation: toastIn 0.25s ease; pointer-events: all;
            min-width: 280px; max-width: 400px;
        }
        .toast.removing { animation: toastOut 0.2s ease forwards; }
        @keyframes toastIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes toastOut { to { opacity: 0; transform: translateX(20px); } }
        .toast.success { border-left: 3px solid var(--green); }
        .toast.error { border-left: 3px solid var(--red); }
        .toast.warning { border-left: 3px solid var(--amber); }
        .toast.info { border-left: 3px solid var(--accent); }
        .toast i { font-size: 15px; }
        .toast.success i { color: var(--green); }
        .toast.error i { color: var(--red); }
        .toast.warning i { color: var(--amber); }
        .toast.info i { color: var(--accent); }

        /* ── Section ─────────────────────────────── */
        .section-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 20px;
        }
        .section-header h2 { font-size: 18px; font-weight: 700; letter-spacing: -0.02em; }

        .footer {
            text-align: center; padding: 24px; font-size: 12px;
            color: var(--text-tertiary); border-top: 1px solid var(--border-subtle);
            margin-top: 32px;
        }
        .footer a { color: var(--accent); text-decoration: none; }

        /* ── Mobile ──────────────────────────────── */
        .mobile-toggle {
            display: none; border: none; background: transparent;
            color: var(--text-secondary); font-size: 18px; cursor: pointer; padding: 4px;
        }
        @media (max-width: 900px) {
            .app { grid-template-columns: 1fr; grid-template-areas: "header" "main"; }
            .sidebar {
                position: fixed; left: -260px; top: 0; bottom: 0;
                width: 260px; z-index: 50; transition: left 0.25s ease;
                box-shadow: var(--shadow-lg);
            }
            .sidebar.open { left: 0; }
            .mobile-toggle { display: block; }
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
            .device-grid, .server-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 500px) {
            .kpi-grid { grid-template-columns: 1fr; }
            .toolbar { flex-direction: column; }
            .search-box { max-width: none; }
        }

        .value-update { animation: valueFlash 0.4s ease; }
        @keyframes valueFlash { 0% { opacity: 0.5; } 100% { opacity: 1; } }

        /* Mobile sidebar overlay */
        .sidebar-overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.5); z-index: 45;
        }
        .sidebar.open ~ .sidebar-overlay { display: block; }
    </style>
</head>
<body>
    <div class="app">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-brand">
                <div class="brand-icon"><i class="fas fa-tower-broadcast"></i></div>
                <h1>Rell<span>Cloud</span></h1>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-label">Monitoring</div>
                <div class="nav-item active" data-view="overview" onclick="switchView('overview')">
                    <i class="fas fa-chart-line"></i> Overview
                </div>
                <div class="nav-item" data-view="devices" onclick="switchView('devices')">
                    <i class="fas fa-ethernet"></i> Devices
                    <span class="badge" id="nav-device-count">0</span>
                </div>
                <div class="nav-item" data-view="servers" onclick="switchView('servers')">
                    <i class="fas fa-server"></i> Servers
                    <span class="badge" id="nav-server-count">0</span>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="sidebar-status">
                    <div class="pulse"></div>
                    <span id="sidebar-timestamp">Connecting...</span>
                </div>
            </div>
        </aside>

        <header class="header">
            <div class="header-left">
                <button class="mobile-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
                <span class="page-title" id="page-title">Overview</span>
            </div>
            <div class="header-right">
                <div class="live-indicator"><div class="dot"></div>LIVE</div>
                <button class="header-btn" onclick="toggleTheme()" title="Toggle theme"><i class="fas fa-moon" id="theme-icon"></i></button>
                <button class="header-btn" onclick="refreshAll()" title="Refresh"><i class="fas fa-arrows-rotate"></i></button>
            </div>
        </header>

        <main class="main">
            <!-- Overview -->
            <div class="view active" id="view-overview">
                <div class="kpi-grid">
                    <div class="kpi-card kpi-total">
                        <div class="kpi-icon"><i class="fas fa-ethernet"></i></div>
                        <div class="kpi-label">Total Devices</div>
                        <div class="kpi-value" id="kpi-total">&mdash;</div>
                        <div class="kpi-sub" id="kpi-total-sub">loading</div>
                    </div>
                    <div class="kpi-card kpi-online">
                        <div class="kpi-icon"><i class="fas fa-signal"></i></div>
                        <div class="kpi-label">Online</div>
                        <div class="kpi-value" id="kpi-online">&mdash;</div>
                        <div class="kpi-sub" id="kpi-online-sub">loading</div>
                    </div>
                    <div class="kpi-card kpi-offline">
                        <div class="kpi-icon"><i class="fas fa-circle-xmark"></i></div>
                        <div class="kpi-label">Offline</div>
                        <div class="kpi-value" id="kpi-offline">&mdash;</div>
                        <div class="kpi-sub" id="kpi-offline-sub">loading</div>
                    </div>
                    <div class="kpi-card kpi-latency">
                        <div class="kpi-icon"><i class="fas fa-gauge-high"></i></div>
                        <div class="kpi-label">Avg Latency</div>
                        <div class="kpi-value" id="kpi-latency">&mdash;</div>
                        <div class="kpi-sub" id="kpi-latency-sub">loading</div>
                    </div>
                </div>
                <div class="section-header">
                    <h2>All Devices</h2>
                    <button class="btn-primary" onclick="openModal('device')"><i class="fas fa-plus"></i> Add Device</button>
                </div>
                <div id="overview-devices" class="device-grid"></div>
                <div class="section-header" style="margin-top:32px">
                    <h2>Servers</h2>
                    <button class="btn-primary" onclick="openModal('server')"><i class="fas fa-plus"></i> Add Server</button>
                </div>
                <div id="overview-servers" class="server-grid"></div>
                <div class="footer">Powered by <a href="#">RellCloud</a> NetOps &mdash; Network Monitoring Platform</div>
            </div>

            <!-- Devices -->
            <div class="view" id="view-devices">
                <div class="section-header">
                    <h2>Devices</h2>
                    <button class="btn-primary" onclick="openModal('device')"><i class="fas fa-plus"></i> Add Device</button>
                </div>
                <div class="toolbar">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="device-search" placeholder="Search devices..." oninput="handleSearch()">
                    </div>
                    <select class="filter-select" id="category-filter" onchange="applyFilters()">
                        <option value="all">All Categories</option>
                        <option value="router">Routers</option>
                        <option value="pi">Raspberry Pi</option>
                        <option value="iot">IoT Devices</option>
                        <option value="server">Servers</option>
                        <option value="other">Other</option>
                    </select>
                    <select class="filter-select" id="sort-filter" onchange="applyFilters()">
                        <option value="name">Name A-Z</option>
                        <option value="latency">Latency Low-High</option>
                        <option value="status">Status</option>
                    </select>
                </div>
                <div id="devices-grid" class="device-grid"></div>
                <div class="footer">Powered by <a href="#">RellCloud</a> NetOps</div>
            </div>

            <!-- Servers -->
            <div class="view" id="view-servers">
                <div class="section-header">
                    <h2>Servers</h2>
                    <button class="btn-primary" onclick="openModal('server')"><i class="fas fa-plus"></i> Add Server</button>
                </div>
                <div id="servers-grid" class="server-grid"></div>
                <div class="footer">Powered by <a href="#">RellCloud</a> NetOps</div>
            </div>
        </main>
    </div>

    <!-- Device Modal -->
    <div class="modal-backdrop" id="modal-device">
        <div class="modal">
            <div class="modal-header">
                <h2>Add Device</h2>
                <button class="modal-close" onclick="closeModal('device')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Device Name</label>
                    <input type="text" id="inp-device-name" placeholder="e.g. Living Room Switch">
                </div>
                <div class="form-group">
                    <label>IP Address</label>
                    <input type="text" id="inp-device-ip" placeholder="e.g. 192.168.1.100">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-ghost" onclick="closeModal('device')">Cancel</button>
                <button class="btn-primary" onclick="addDevice()">Add Device</button>
            </div>
        </div>
    </div>

    <!-- Server Modal -->
    <div class="modal-backdrop" id="modal-server">
        <div class="modal">
            <div class="modal-header">
                <h2>Add Server</h2>
                <button class="modal-close" onclick="closeModal('server')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Server Name</label>
                    <input type="text" id="inp-server-name" placeholder="e.g. Production DB">
                </div>
                <div class="form-group">
                    <label>Host / IP</label>
                    <input type="text" id="inp-server-host" placeholder="e.g. 192.168.1.200">
                </div>
                <div class="form-group">
                    <label>SSH Port</label>
                    <input type="number" id="inp-server-port" value="22" placeholder="22">
                </div>
                <div class="form-group">
                    <label>SSH Username</label>
                    <input type="text" id="inp-server-user" placeholder="e.g. admin">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="inp-server-desc" placeholder="Optional description">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-ghost" onclick="closeModal('server')">Cancel</button>
                <button class="btn-primary" onclick="addServer()">Add Server</button>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <script>
    const state = {
        currentView: 'overview',
        devices: {},
        servers: {},
        stats: { total: 0, online: 0, offline: 0, avg_latency: 0 },
        history: {},
        previousStatus: {},
        config: {},
        searchTerm: '',
        categoryFilter: 'all',
        sortBy: 'name'
    };

    const HISTORY_MAX = 60;
    const REFRESH_MS = 2000;
    const SERVER_REFRESH_MS = 15000;

    document.addEventListener('DOMContentLoaded', () => {
        loadConfig();
        refreshAll();
        setInterval(refreshDeviceData, REFRESH_MS);
        setInterval(refreshServerData, SERVER_REFRESH_MS);
    });

    function switchView(view) {
        state.currentView = view;
        document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.view === view));
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        const el = document.getElementById('view-' + view);
        if (el) el.classList.add('active');
        const titles = { overview: 'Overview', devices: 'Devices', servers: 'Servers' };
        document.getElementById('page-title').textContent = titles[view] || 'Overview';
        document.getElementById('sidebar').classList.remove('open');
        if (view === 'servers') refreshServerData();
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
    }

    function toggleTheme() {
        const html = document.documentElement;
        const isDark = html.getAttribute('data-theme') === 'dark';
        html.setAttribute('data-theme', isDark ? 'light' : 'dark');
        document.getElementById('theme-icon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
    }

    async function loadConfig() {
        try {
            const r = await fetch('/api/config');
            state.config = await r.json();
        } catch (e) { /* optional */ }
    }

    async function refreshAll() {
        await Promise.all([refreshDeviceData(), refreshServerData()]);
    }

    async function refreshDeviceData() {
        try {
            const r = await fetch('/api/data');
            const data = await r.json();
            if (data.error) return;
            const devices = data.devices || {};
            const ts = data.timestamp || '';

            for (const [name, info] of Object.entries(devices)) {
                const wasOnline = state.previousStatus[name];
                const isOnline = info.reachable;
                if (wasOnline === true && isOnline === false) {
                    toast(name + ' went offline', 'error');
                    sendWebhook(name, 'offline', info.ip);
                } else if (wasOnline === false && isOnline === true) {
                    toast(name + ' is back online', 'success');
                }
                if (isOnline && info.latency > 200) {
                    toast(name + ' high latency: ' + info.latency.toFixed(1) + 'ms', 'warning');
                }
                state.previousStatus[name] = isOnline;
                if (!state.history[name]) state.history[name] = [];
                if (isOnline && info.latency != null) {
                    state.history[name].push(info.latency);
                    if (state.history[name].length > HISTORY_MAX) state.history[name].shift();
                }
            }

            state.devices = devices;
            const total = Object.keys(devices).length;
            const online = Object.values(devices).filter(d => d.reachable).length;
            const offline = total - online;
            const lats = Object.values(devices).filter(d => d.reachable && d.latency).map(d => d.latency);
            const avg = lats.length ? lats.reduce((a, b) => a + b, 0) / lats.length : 0;
            state.stats = { total, online, offline, avg_latency: avg, timestamp: ts };

            renderKPIs();
            renderDevices();
            updateTimestamp(ts);
            updateNavBadges();
        } catch (e) { /* retry next cycle */ }
    }

    async function refreshServerData() {
        try {
            const r = await fetch('/api/servers');
            const data = await r.json();
            if (!data.error) {
                state.servers = data;
                renderServers();
                updateNavBadges();
            }
        } catch (e) { /* retry */ }
    }

    function renderKPIs() {
        const s = state.stats;
        animateValue('kpi-total', s.total);
        animateValue('kpi-online', s.online);
        animateValue('kpi-offline', s.offline);
        const latEl = document.getElementById('kpi-latency');
        latEl.innerHTML = s.avg_latency > 0 ? s.avg_latency.toFixed(1) + '<span class="unit">ms</span>' : '&mdash;';
        latEl.classList.add('value-update');
        setTimeout(() => latEl.classList.remove('value-update'), 400);

        const pct = s.total > 0 ? Math.round((s.online / s.total) * 100) : 0;
        document.getElementById('kpi-total-sub').textContent = s.total + ' monitored';
        document.getElementById('kpi-online-sub').textContent = s.total > 0 ? pct + '% uptime' : '\u2014';
        document.getElementById('kpi-offline-sub').textContent = s.offline > 0 ? s.offline + ' unreachable' : 'all clear';
        const latQuality = s.avg_latency <= 0 ? '\u2014' : s.avg_latency < 10 ? 'excellent' : s.avg_latency < 50 ? 'good' : s.avg_latency < 100 ? 'fair' : 'poor';
        document.getElementById('kpi-latency-sub').textContent = latQuality;
    }

    function animateValue(id, val) {
        const el = document.getElementById(id);
        if (el.textContent !== String(val)) {
            el.textContent = val;
            el.classList.add('value-update');
            setTimeout(() => el.classList.remove('value-update'), 400);
        }
    }

    function renderDevices() {
        let filtered = Object.entries(state.devices);
        if (state.searchTerm) {
            const q = state.searchTerm.toLowerCase();
            filtered = filtered.filter(([name, d]) => name.toLowerCase().includes(q) || (d.ip && d.ip.includes(q)));
        }
        if (state.categoryFilter !== 'all') {
            filtered = filtered.filter(([name]) => categorize(name) === state.categoryFilter);
        }
        filtered.sort((a, b) => {
            if (state.sortBy === 'name') return a[0].localeCompare(b[0]);
            if (state.sortBy === 'latency') return (a[1].latency || 9999) - (b[1].latency || 9999);
            if (state.sortBy === 'status') return (b[1].reachable ? 1 : 0) - (a[1].reachable ? 1 : 0);
            return 0;
        });
        renderDeviceGrid('overview-devices', filtered);
        renderDeviceGrid('devices-grid', filtered);
    }

    function renderDeviceGrid(containerId, entries) {
        const container = document.getElementById(containerId);
        if (!container) return;
        if (entries.length === 0) {
            container.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><i class="fas fa-satellite-dish"></i><h3>No devices found</h3><p>' + (state.searchTerm ? 'Try a different search term' : 'Add your first device to start monitoring') + '</p></div>';
            return;
        }
        const currentKeys = entries.map(([n]) => n).join(',');
        if (container.dataset.keys === currentKeys) {
            entries.forEach(([name, device]) => updateDeviceCardInPlace(container, name, device));
            return;
        }
        container.dataset.keys = currentKeys;
        container.innerHTML = entries.map(([name, device]) => buildDeviceCard(name, device)).join('');
    }

    function buildDeviceCard(name, device) {
        const online = device.reachable;
        const latency = device.latency;
        const cat = categorize(name);
        const latClass = !online ? 'down' : latency < 10 ? 'good' : latency < 100 ? 'warn' : 'bad';
        const sparkSvg = buildSparkline(state.history[name] || [], online);
        const safeName = esc(name);
        return '<div class="device-card ' + (online ? 'online' : 'offline') + '" data-device="' + safeName + '">'
            + '<div class="device-card-header"><div class="device-info"><h3>' + safeName + '</h3>'
            + '<div class="device-ip">' + esc(device.ip || '\u2014') + '</div></div>'
            + '<div class="status-dot ' + (online ? 'online' : 'offline') + '"></div></div>'
            + '<div class="device-latency ' + latClass + '" data-lat="' + safeName + '">'
            + (online && latency != null ? latency.toFixed(1) + '<span class="unit">ms</span>' : 'OFFLINE') + '</div>'
            + '<div class="device-sparkline" data-spark="' + safeName + '">' + sparkSvg + '</div>'
            + '<div class="device-card-footer"><span class="device-category">' + cat + '</span>'
            + '<button class="device-delete" onclick="deleteDevice(\'' + safeName.replace(/'/g, "\\'") + '\')" title="Remove"><i class="fas fa-trash-can"></i></button>'
            + '</div></div>';
    }

    function updateDeviceCardInPlace(container, name, device) {
        const safeName = esc(name);
        const card = container.querySelector('[data-device="' + safeName + '"]');
        if (!card) return;
        const online = device.reachable;
        card.className = 'device-card ' + (online ? 'online' : 'offline');
        const latEl = card.querySelector('[data-lat="' + safeName + '"]');
        if (latEl) {
            const latency = device.latency;
            const latClass = !online ? 'down' : latency < 10 ? 'good' : latency < 100 ? 'warn' : 'bad';
            const newHtml = online && latency != null ? latency.toFixed(1) + '<span class="unit">ms</span>' : 'OFFLINE';
            if (latEl.innerHTML !== newHtml) {
                latEl.innerHTML = newHtml;
                latEl.className = 'device-latency ' + latClass;
                latEl.classList.add('value-update');
                setTimeout(() => latEl.classList.remove('value-update'), 400);
            }
        }
        const sparkEl = card.querySelector('[data-spark="' + safeName + '"]');
        if (sparkEl) sparkEl.innerHTML = buildSparkline(state.history[name] || [], online);
    }

    function renderServers() {
        const entries = Object.entries(state.servers);
        renderServerGrid('overview-servers', entries);
        renderServerGrid('servers-grid', entries);
    }

    function renderServerGrid(containerId, entries) {
        const container = document.getElementById(containerId);
        if (!container) return;
        if (entries.length === 0) {
            container.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><i class="fas fa-server"></i><h3>No servers configured</h3><p>Add servers to monitor SSH connectivity</p></div>';
            return;
        }
        container.innerHTML = entries.map(([name, srv]) => {
            const safeName = esc(name);
            const st = srv.status || 'offline';
            return '<div class="server-card"><div class="server-card-header">'
                + '<span class="server-name">' + safeName + '</span>'
                + '<span class="server-status ' + st + '">' + st + '</span></div>'
                + '<div class="server-meta">'
                + (srv.description ? '<div class="server-meta-row"><i class="fas fa-info-circle"></i>' + esc(srv.description) + '</div>' : '')
                + '<div class="server-meta-row"><i class="fas fa-network-wired"></i><span class="mono">' + esc(srv.host) + ':' + srv.port + '</span></div>'
                + '<div class="server-meta-row"><i class="fas fa-user"></i>' + esc(srv.user) + '</div></div>'
                + '<div class="server-checks">'
                + '<span class="check-badge ' + (srv.ssh_online ? 'pass' : 'fail') + '"><i class="fas fa-' + (srv.ssh_online ? 'check' : 'xmark') + '"></i> SSH</span>'
                + '<span class="check-badge ' + (srv.ping_online ? 'pass' : 'fail') + '"><i class="fas fa-' + (srv.ping_online ? 'check' : 'xmark') + '"></i> Ping</span></div>'
                + '<div class="server-actions">'
                + '<button class="ssh-copy-btn" onclick="copySSH(this,\'' + escAttr(srv.ssh_command || '') + '\')"><i class="fas fa-copy"></i> ' + esc(srv.ssh_command || '\u2014') + '</button>'
                + '<button class="server-delete-btn" onclick="deleteServer(\'' + safeName.replace(/'/g, "\\'") + '\')" title="Delete"><i class="fas fa-trash-can"></i></button>'
                + '</div></div>';
        }).join('');
    }

    function buildSparkline(data, online) {
        if (!data || data.length < 2) {
            return '<svg viewBox="0 0 200 40"><text x="100" y="24" text-anchor="middle" fill="var(--text-tertiary)" font-size="11" font-family="var(--font-mono)">awaiting data...</text></svg>';
        }
        const w = 200, h = 40, pad = 2;
        const max = Math.max(...data, 1);
        const min = Math.min(...data, 0);
        const range = max - min || 1;
        const pts = data.map((v, i) => {
            const x = pad + (i / (data.length - 1)) * (w - 2 * pad);
            const y = h - pad - ((v - min) / range) * (h - 2 * pad);
            return x.toFixed(1) + ',' + y.toFixed(1);
        });
        const avg = data.reduce((a, b) => a + b, 0) / data.length;
        const lineColor = !online ? 'var(--red)' : avg < 10 ? 'var(--green)' : avg < 100 ? 'var(--accent)' : 'var(--amber)';
        const fillColor = !online ? 'var(--red-dim)' : 'rgba(34,211,238,0.08)';
        const polyline = pts.join(' ');
        const lastPt = pts[pts.length - 1].split(',');
        return '<svg viewBox="0 0 ' + w + ' ' + h + '" preserveAspectRatio="none">'
            + '<polygon points="' + polyline + ' ' + (w - pad) + ',' + (h - pad) + ' ' + pad + ',' + (h - pad) + '" fill="' + fillColor + '" />'
            + '<polyline points="' + polyline + '" fill="none" stroke="' + lineColor + '" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />'
            + '<circle cx="' + lastPt[0] + '" cy="' + lastPt[1] + '" r="2.5" fill="' + lineColor + '" />'
            + '</svg>';
    }

    function categorize(name) {
        const n = name.toLowerCase();
        if (n.includes('router') || n.includes('gateway') || n.includes('mesh') || n.includes('ap')) return 'router';
        if (n.includes('rpi') || n.includes('raspberry') || n.includes('pi')) return 'pi';
        if (n.includes('iot') || n.includes('sensor') || n.includes('cam') || n.includes('plug') || n.includes('switch') || n.includes('bulb')) return 'iot';
        if (n.includes('server') || n.includes('vm') || n.includes('node') || n.includes('db') || n.includes('nas')) return 'server';
        return 'other';
    }

    let searchTimeout;
    function handleSearch() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            state.searchTerm = document.getElementById('device-search').value;
            applyFilters();
        }, 200);
    }

    function applyFilters() {
        state.categoryFilter = document.getElementById('category-filter').value;
        state.sortBy = document.getElementById('sort-filter').value;
        renderDevices();
    }

    function updateNavBadges() {
        document.getElementById('nav-device-count').textContent = Object.keys(state.devices).length;
        document.getElementById('nav-server-count').textContent = Object.keys(state.servers).length;
    }

    function updateTimestamp(ts) {
        const el = document.getElementById('sidebar-timestamp');
        if (!ts) { el.textContent = 'Connecting...'; return; }
        try {
            const d = new Date(ts);
            el.textContent = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        } catch (e) { el.textContent = 'Live'; }
    }

    async function addDevice() {
        const name = document.getElementById('inp-device-name').value.trim();
        const ip = document.getElementById('inp-device-ip').value.trim();
        if (!name || !ip) { toast('Name and IP are required', 'warning'); return; }
        if (!/^(\d{1,3}\.){3}\d{1,3}$/.test(ip)) { toast('Invalid IP address format', 'warning'); return; }
        try {
            const r = await fetch('/api/devices', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, ip }) });
            const data = await r.json();
            if (r.ok) {
                toast(name + ' added', 'success');
                closeModal('device');
                document.getElementById('inp-device-name').value = '';
                document.getElementById('inp-device-ip').value = '';
                refreshDeviceData();
            } else { toast(data.message || 'Failed to add device', 'error'); }
        } catch (e) { toast('Network error', 'error'); }
    }

    async function deleteDevice(name) {
        if (!confirm('Remove "' + name + '" from monitoring?')) return;
        try {
            const r = await fetch('/api/devices', { method: 'DELETE', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name }) });
            if (r.ok) {
                toast(name + ' removed', 'info');
                delete state.history[name];
                delete state.previousStatus[name];
                refreshDeviceData();
            } else { toast('Failed to remove device', 'error'); }
        } catch (e) { toast('Network error', 'error'); }
    }

    async function addServer() {
        const name = document.getElementById('inp-server-name').value.trim();
        const host = document.getElementById('inp-server-host').value.trim();
        const port = parseInt(document.getElementById('inp-server-port').value) || 22;
        const user = document.getElementById('inp-server-user').value.trim();
        const description = document.getElementById('inp-server-desc').value.trim();
        if (!name || !host || !user) { toast('Name, host, and user are required', 'warning'); return; }
        try {
            const r = await fetch('/api/servers', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, host, port, user, description }) });
            const data = await r.json();
            if (r.ok) {
                toast(name + ' added', 'success');
                closeModal('server');
                ['inp-server-name', 'inp-server-host', 'inp-server-user', 'inp-server-desc'].forEach(id => document.getElementById(id).value = '');
                document.getElementById('inp-server-port').value = '22';
                refreshServerData();
            } else { toast(data.message || 'Failed to add server', 'error'); }
        } catch (e) { toast('Network error', 'error'); }
    }

    async function deleteServer(name) {
        if (!confirm('Delete server "' + name + '"?')) return;
        try {
            const r = await fetch('/api/servers/' + encodeURIComponent(name), { method: 'DELETE' });
            if (r.ok) { toast(name + ' deleted', 'info'); refreshServerData(); }
            else { toast('Failed to delete server', 'error'); }
        } catch (e) { toast('Network error', 'error'); }
    }

    function copySSH(btn, cmd) {
        navigator.clipboard.writeText(cmd).then(() => {
            btn.classList.add('copied');
            const orig = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = orig; }, 1500);
        }).catch(() => toast('Copy failed', 'error'));
    }

    function openModal(type) { document.getElementById('modal-' + type).classList.add('open'); }
    function closeModal(type) { document.getElementById('modal-' + type).classList.remove('open'); }

    document.querySelectorAll('.modal-backdrop').forEach(bd => {
        bd.addEventListener('click', (e) => { if (e.target === bd) bd.classList.remove('open'); });
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') document.querySelectorAll('.modal-backdrop.open').forEach(m => m.classList.remove('open'));
    });

    function toast(message, type) {
        type = type || 'info';
        const container = document.getElementById('toast-container');
        const icons = { success: 'fa-check-circle', error: 'fa-circle-exclamation', warning: 'fa-triangle-exclamation', info: 'fa-circle-info' };
        const el = document.createElement('div');
        el.className = 'toast ' + type;
        el.innerHTML = '<i class="fas ' + (icons[type] || icons.info) + '"></i><span>' + esc(message) + '</span>';
        container.appendChild(el);
        setTimeout(() => { el.classList.add('removing'); setTimeout(() => el.remove(), 200); }, 4000);
    }

    async function sendWebhook(deviceName, status, ip) {
        const url = state.config.webhook_url;
        if (!url) return;
        try {
            await fetch(url, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ embeds: [{ title: 'Network Alert: ' + deviceName, description: '**' + deviceName + '** (' + ip + ') is now **' + status.toUpperCase() + '**', color: status === 'offline' ? 0xef4444 : 0x10b981, timestamp: new Date().toISOString(), footer: { text: 'RellCloud NetOps' } }] })
            });
        } catch (e) { /* non-critical */ }
    }

    function esc(str) {
        const d = document.createElement('div');
        d.textContent = String(str);
        return d.innerHTML;
    }

    function escAttr(str) {
        return String(str).replace(/'/g, "\\'").replace(/"/g, '&quot;');
    }
    </script>
</body>
</html>
